# Release Notes v2.8.0

**Release Date:** 2026-02-09
**Type:** Major Bug Fix & Feature Release

## Overview

9ê°œ ì£¼ìš” ì´ìŠˆ ìˆ˜ì •: RLS ì •ì±… ì „ë©´ ê°œí¸, ë‚ ì§œ ì‹œê°„ëŒ€ ë²„ê·¸ ìˆ˜ì •, Google OAuth ì´ì¤‘ ë¡œê·¸ì¸ í•´ê²°, ì„¤êµ íŒŒì¼ ì²¨ë¶€, êµì¸ CSV Import, ì„±ê²½í†µë… ë‹¤ì¤‘ ì±… ì§€ì›, ë©”ì¸ í˜ì´ì§€ ìœ íŠœë¸Œ ì˜ìƒ, ìƒˆê°€ì¡± êµì¸ ìë™ ì „í™˜.

---

## ğŸ”´ Critical Fixes

### 1. ì „ì²´ RLS ì •ì±… admin_users ê¸°ë°˜ ì „í™˜

**ë¬¸ì œ**: ì£¼ë³´ PDF ì—…ë¡œë“œ ë“± ê´€ë¦¬ì ê¸°ëŠ¥ì—ì„œ `StorageApiError: new row violates row-level security policy` ë°œìƒ. RLS ì •ì±…ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `profiles` í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ê³  ìˆì—ˆìŒ.

**í•´ê²°**: 13ê°œ í…Œì´ë¸” + 7ê°œ Storage ë²„í‚·ì˜ RLS ì •ì±…ì„ `admin_users` í…Œì´ë¸” ê¸°ë°˜ìœ¼ë¡œ ì „ë©´ êµì²´.

- **í…Œì´ë¸”**: bulletins, sermons, bible_reading_plans, bible_reading_entries, church_members, email_subscribers, newsletter_logs, hero_slides, new_families, new_family_registrations, bible_materials, posts, prayer_requests
- **ë²„í‚·**: bulletins, bible-materials, sermons(ì‹ ê·œ), members, posts, covers, slides
- **ì¸ì¦ íŒ¨í„´**: `LOWER(admin_users.email) = LOWER(auth.jwt()->>'email')`
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: `supabase/migrations/20260209_fix_all_rls_policies.sql`

> **ë°°í¬ í›„ í•„ìˆ˜ ì‘ì—…**: Supabase Dashboard SQL Editorì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ì‹¤í–‰ í•„ìš”

### 2. QT/ì„¤êµ ë‚ ì§œ í•˜ë£¨ ë°€ë¦¼ ìˆ˜ì •

**ë¬¸ì œ**: ì„¤êµ ë‚ ì§œê°€ í•˜ë£¨ ì „ìœ¼ë¡œ í‘œì‹œ (ì˜ˆ: 2/8 ì„¤êµ â†’ "2026ë…„ 2ì›” 7ì¼"). `new Date("2026-02-08")`ì´ UTC ìì •ìœ¼ë¡œ íŒŒì‹±ë˜ì–´ EST(-5h) ê¸°ì¤€ ì „ë‚ ë¡œ í‘œì‹œ.

**í•´ê²°**: `dateHelpers.ts` ìœ í‹¸ë¦¬í‹° ìƒì„±í•˜ì—¬ ë¡œì»¬ ì‹œê°„ëŒ€ ê¸°ë°˜ íŒŒì‹±.

```typescript
parseLocalDate("2026-02-08")  // â†’ new Date(2026, 1, 8) ë¡œì»¬ ì‹œê°„
toLocalDateString()            // â†’ "2026-02-08" ë¡œì»¬ ë‚ ì§œ
```

- **ìˆ˜ì • íŒŒì¼**: bibleReadingService.ts (9ê³³), sermonService.ts, memberService.ts, sermons/new.tsx, sermons/sunday.tsx

### 3. Google OAuth ì´ì¤‘ ë¡œê·¸ì¸ í•´ê²°

**ë¬¸ì œ**: êµ¬ê¸€ ë¡œê·¸ì¸ ì‹œ ì²« ì‹œë„ì—ì„œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ì˜¤ê³  ë‘ ë²ˆì§¸ì— ì„±ê³µ.

**ê·¼ë³¸ ì›ì¸**: `onAuthStateChange`ì—ì„œ `!session` ì²´í¬ ì‹œ OAuth ì½œë°± ì¤‘ ì¼ì‹œì  null ìƒíƒœì—ì„œ premature redirect ë°œìƒ.

**ìˆ˜ì • ì‚¬í•­**:
- `useAdminAuth.ts`: `event === 'SIGNED_OUT'` ì²´í¬ë¡œ ë³€ê²½ + ì½œë°± ê²½ë¡œ guard ì¶”ê°€
- `AdminLoginForm.tsx`: `prompt: 'consent'` â†’ `prompt: 'select_account'`
- `callback.tsx`: `router.push` â†’ `router.replace` (íˆìŠ¤í† ë¦¬ ì •ë¦¬)

---

## ğŸš€ New Features

### 4. ì„¤êµ íŒŒì¼ ì²¨ë¶€ ê¸°ëŠ¥

ì„¤êµ ë“±ë¡ ì‹œ PDF/PPT/DOCX ë“± ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ì§€ì›.

- `sermons` í…Œì´ë¸”ì— `attachment_url`, `attachment_name` ì»¬ëŸ¼ ì¶”ê°€
- `sermons` Storage ë²„í‚· ìƒì„± + RLS ì •ì±…
- ì„¤êµ ë“±ë¡ í¼ì— íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ ì¶”ê°€ (accept: `.pdf,.ppt,.pptx,.doc,.docx`)
- `uploadSermonAttachment()`, `deleteSermonAttachment()` í•¨ìˆ˜ ì¶”ê°€

### 5. êµì¸ CSV Import

ê´€ë¦¬ì êµì¸ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ CSV íŒŒì¼ ì¼ê´„ ì—…ë¡œë“œ ê¸°ëŠ¥.

- UTF-8 BOM ìë™ ì œê±°
- í•œêµ­ì–´ í—¤ë” ìë™ ë§¤í•‘ (ì´ë¦„(í•œê¸€) â†’ korean_name ë“±)
- í•œêµ­ì–´ ê°’ ë³€í™˜ (ë‚¨ â†’ male, ì§‘ì‚¬ â†’ deacon, í™œë™ â†’ active)
- `korean_name` + `phone` ì¡°í•© ì¤‘ë³µ ê²€ì‚¬
- Import ì „ ë¯¸ë¦¬ë³´ê¸° (ìµœëŒ€ 10í–‰)
- ê²°ê³¼ ë¦¬í¬íŠ¸ (ì„±ê³µ/ì¤‘ë³µ/ì‹¤íŒ¨ ê±´ìˆ˜)
- CSV í…œí”Œë¦¿: `docs/examples/members_import_template.csv`

### 6. ì„±ê²½í†µë… ë‹¤ì¤‘ ì±… + PDF ë®ì–´ì“°ê¸°

- PDF ì—…ë¡œë“œ ì‹œ `upsert: true`ë¡œ ë³€ê²½ (ì¤‘ë³µ íŒŒì¼ëª… ë®ì–´ì“°ê¸° í—ˆìš©)
- ìë£Œ ë“±ë¡/ìˆ˜ì • UI: ë‹¨ì¼ ì„ íƒ ë“œë¡­ë‹¤ìš´ â†’ ë‹¤ì¤‘ ì„ íƒ ì²´í¬ë°•ìŠ¤
- `book_name` í•„ë“œì— ì½¤ë§ˆ êµ¬ë¶„ ë‹¤ì¤‘ ì±… ì €ì¥ (ì˜ˆ: "ì°½ì„¸ê¸°,ìš¥ê¸°")
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë‹¤ì¤‘ ì±… ì´ë¦„ í‘œì‹œ

### 7. ë©”ì¸ í˜ì´ì§€ ìµœì‹  ì£¼ì¼ì„¤êµ ìœ íŠœë¸Œ ì˜ìƒ

- `LatestSermonVideo` ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ ìƒì„±
- ìµœì‹  published sunday sermon ìë™ ì¡°íšŒ â†’ YouTube iframe í‘œì‹œ
- VS Design Diverge ìŠ¤íƒ€ì¼ (Deep Indigo ë°°ê²½, Editorial í—¤ë”, grain ì˜¤ë²„ë ˆì´)
- ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ (ëª¨ë°”ì¼ ìŠ¤íƒ / ë°ìŠ¤í¬í†± 3+2 ê·¸ë¦¬ë“œ)
- ë©”ì¸ í˜ì´ì§€ ì˜ˆë°° ì„¹ì…˜ ì•„ë˜ ë°°ì¹˜

### 8. ìƒˆê°€ì¡± â†’ êµì¸ ìë™ ì „í™˜

- `convertToMember()` í•¨ìˆ˜: ìƒˆê°€ì¡± ë°ì´í„° â†’ church_members ìë™ ìƒì„±
- í•„ë“œ ë§¤í•‘: name â†’ korean_name, email, phone, address, birth_date, gender, baptized
- ìƒíƒœë¥¼ 'ë“±ë¡ì™„ë£Œ'ë¡œ ë³€ê²½ ì‹œ ìë™ ì „í™˜ íŠ¸ë¦¬ê±°
- ê´€ë¦¬ì ìƒì„¸ í˜ì´ì§€ì— ìˆ˜ë™ "êµì¸ ë“±ë¡" ë²„íŠ¼ ì¶”ê°€
- í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ + ì„±ê³µ/ì—ëŸ¬ ì•Œë¦¼

---

## ğŸ¨ UI Improvements

### PageHeader ì»´í¬ë„ŒíŠ¸ í†µí•©

ì—¬ëŸ¬ í˜ì´ì§€ì˜ ì¤‘ë³µ Hero ì„¹ì…˜ì„ `PageHeader` ì»´í¬ë„ŒíŠ¸ë¡œ í†µí•©í•˜ì—¬ ì½”ë“œëŸ‰ ëŒ€í­ ê°ì†Œ.

**ì ìš© í˜ì´ì§€**: announcements, worship, korean-school, training, bible-reading, settlement-info, missionary-support, short-term, relief

---

## ğŸ”§ Technical Changes

### Files Created (7)
| File | Description |
|------|-------------|
| `src/utils/dateHelpers.ts` | UTC íŒŒì‹± ë°©ì§€ ë‚ ì§œ ìœ í‹¸ë¦¬í‹° |
| `src/components/LatestSermonVideo.tsx` | ìµœì‹  ì„¤êµ ìœ íŠœë¸Œ ì»´í¬ë„ŒíŠ¸ |
| `supabase/migrations/20260209_fix_all_rls_policies.sql` | ì „ì²´ RLS ë§ˆì´ê·¸ë ˆì´ì…˜ |
| `docs/examples/members_import_template.csv` | CSV Import í…œí”Œë¦¿ |
| `docs/features/csv-import-guide.md` | CSV Import ê°€ì´ë“œ |
| `docs/.meta/sessions/2026-01-20_bible-materials-banner-update.md` | ì„¸ì…˜ ë¡œê·¸ |
| `src/pages/training/new-family.tsx` | ìƒˆê°€ì¡± í›ˆë ¨ í˜ì´ì§€ |

### Files Modified (29)
| File | Changes |
|------|---------|
| `src/hooks/useAdminAuth.ts` | OAuth ì½œë°± premature redirect ë°©ì§€ |
| `src/components/AdminLoginForm.tsx` | prompt: consent â†’ select_account |
| `src/pages/auth/callback.tsx` | router.push â†’ router.replace |
| `types/supabase.ts` | sermon attachment íƒ€ì… ì¶”ê°€ |
| `src/utils/sermonService.ts` | ë‚ ì§œ ìˆ˜ì • + ì²¨ë¶€íŒŒì¼ í•¨ìˆ˜ |
| `src/utils/bibleReadingService.ts` | ë‚ ì§œ ìˆ˜ì • (9ê³³) |
| `src/utils/memberService.ts` | ë‚ ì§œ ìˆ˜ì • + CSV Import í•¨ìˆ˜ |
| `src/utils/bibleMaterialsService.ts` | upsert:true + ë‹¤ì¤‘ ì±… ì§€ì› |
| `src/utils/newFamilyService.ts` | convertToMember í•¨ìˆ˜ |
| `src/pages/admin/sermons/new.tsx` | ë‚ ì§œ ìˆ˜ì • + íŒŒì¼ ì²¨ë¶€ UI |
| `src/pages/admin/members/index.tsx` | CSV Import ëª¨ë‹¬ |
| `src/pages/admin/bible-materials/new.tsx` | ë‹¤ì¤‘ ì±… ì²´í¬ë°•ìŠ¤ UI |
| `src/pages/admin/bible-materials/[id].tsx` | ë‹¤ì¤‘ ì±… í¸ì§‘ UI |
| `src/pages/admin/new-families/index.tsx` | ìë™ ì „í™˜ + êµì¸ ë“±ë¡ ë²„íŠ¼ |
| `src/pages/bible-materials/index.tsx` | ë‹¤ì¤‘ ì±… í‘œì‹œ + PageHeader |
| `src/pages/sermons/sunday.tsx` | formatDate ë‚ ì§œ ìˆ˜ì • |
| `src/pages/index.tsx` | LatestSermonVideo ì‚½ì… |
| `src/components/Layout.tsx` | ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸ |
| `src/components/PageHeader.tsx` | ì´ë¯¸ì§€ ë°°ê²½ ì§€ì› í™•ì¥ |
| `src/pages/announcements.tsx` | PageHeader í†µí•© |
| `src/pages/worship.tsx` | PageHeader í†µí•© |
| `src/pages/korean-school.tsx` | PageHeader í†µí•© |
| `src/pages/training/index.tsx` | PageHeader í†µí•© |
| `src/pages/bible-reading.tsx` | PageHeader í†µí•© |
| `src/pages/community/settlement-info.tsx` | PageHeader í†µí•© |
| `src/pages/missions/missionary-support.tsx` | PageHeader í†µí•© |
| `src/pages/missions/short-term.tsx` | PageHeader í†µí•© |
| `src/pages/missions/relief.tsx` | PageHeader í†µí•© |
| `docs/.meta/context.json` | ë²„ì „ ë° ê¸°ìˆ ìŠ¤íƒ ì—…ë°ì´íŠ¸ |

### Database Changes
- `sermons` í…Œì´ë¸”: `attachment_url TEXT`, `attachment_name TEXT` ì»¬ëŸ¼ ì¶”ê°€
- `sermons` Storage ë²„í‚· ìƒì„±
- 13ê°œ í…Œì´ë¸” RLS ì •ì±… ì¬ìƒì„± (admin_users ê¸°ë°˜)
- 7ê°œ Storage ë²„í‚· RLS ì •ì±… ì¬ìƒì„±

---

## ğŸ“Š Build Statistics

| Metric | Value |
|--------|-------|
| Total Pages | 134 |
| New Pages | 2 |
| Modified Pages | 27 |
| Build Errors | 0 |
| Lines Added | ~1,296 |
| Lines Removed | ~1,006 |

---

## ğŸŒ Deployment

- **Platform:** Vercel (ìë™ ë°°í¬)
- **Production URL:** https://www.sckc.org
- **Status:** Deployed

---

## ğŸ”„ Migration Notes

### í•„ìˆ˜: Supabase SQL ì‹¤í–‰
1. Supabase Dashboard â†’ SQL Editor ì ‘ì†
2. `supabase/migrations/20260209_fix_all_rls_policies.sql` ë‚´ìš© ë³µì‚¬í•˜ì—¬ ì‹¤í–‰
3. ì‹¤í–‰ í›„ í™•ì¸:
   - ì£¼ë³´ PDF ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
   - ì„¤êµ ë“±ë¡ + íŒŒì¼ ì²¨ë¶€ í…ŒìŠ¤íŠ¸
   - ìƒˆê°€ì¡± ë“±ë¡ í…ŒìŠ¤íŠ¸
   - ì„±ê²½í†µë… PDF ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

### í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] RLS ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ì‹¤í–‰
- [ ] ì£¼ë³´ PDF ì—…ë¡œë“œ ì •ìƒ ë™ì‘
- [ ] ì„¤êµ ë‚ ì§œ ì •í™•íˆ í‘œì‹œ (í•˜ë£¨ ë°€ë¦¼ ì—†ìŒ)
- [ ] Google ë¡œê·¸ì¸ í•œ ë²ˆì— ì„±ê³µ
- [ ] ì„¤êµ íŒŒì¼ ì²¨ë¶€ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
- [ ] êµì¸ CSV Import ì •ìƒ ë™ì‘
- [ ] ì„±ê²½í†µë… ë‹¤ì¤‘ ì±… ì„ íƒ/í‘œì‹œ
- [ ] ë©”ì¸ í˜ì´ì§€ ìœ íŠœë¸Œ ì˜ìƒ í‘œì‹œ
- [ ] ìƒˆê°€ì¡± â†’ êµì¸ ì „í™˜ ì •ìƒ ë™ì‘

### Breaking Changes
- ì—†ìŒ (ê¸°ì¡´ URL ë° ê¸°ëŠ¥ ìœ ì§€)

---

## ğŸ“ Known Issues

1. `sermons` Storage ë²„í‚·ì€ SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ ìƒì„±ë¨
2. ì¼ë¶€ admin í˜ì´ì§€ `<img>` â†’ `<Image />` ê²½ê³  (ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ)
3. ìƒˆê°€ì¡± ë“±ë¡ í¼ ê³µê°œ INSERT ê´€ë ¨ ì¶”ê°€ DB ì„¤ì • í•„ìš” â†’ v2.8.1ì—ì„œ í•´ê²°
