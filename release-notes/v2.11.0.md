# Release Notes v2.11.0

**Release Date:** 2026-02-09
**Type:** Bug Fix & Infrastructure Release
**Previous:** v2.10.0

## Overview

ë³´ì•ˆ ì •ì±…(CSP) ìˆ˜ì •, Supabase Storage ë²„í‚· ìƒì„±, ìƒˆê°€ì¡± ë“±ë¡ ë§í¬ ìˆ˜ì •, ì£¼ë³´ ë¯¸ë¦¬ë³´ê¸° ë³µêµ¬, ì´ë©”ì¼ ë°œì†¡ ì„¤ì • ê´€ë¦¬ UI ì¶”ê°€. ì¸í”„ë¼ ê¸°ë°˜ ì •ë¹„ì™€ ë‰´ìŠ¤ë ˆí„° ì´ë©”ì¼ ë°œì†¡ ì¤€ë¹„ì— ì§‘ì¤‘í•œ ë¦´ë¦¬ìŠ¤ì…ë‹ˆë‹¤.

---

## ğŸ› Bug Fixes

### 1. CSP (Content Security Policy) - Pretendard í°íŠ¸ ì°¨ë‹¨ í•´ê²°

**ë¬¸ì œ**: `cdn.jsdelivr.net`ì—ì„œ ë¡œë“œí•˜ëŠ” Pretendard í°íŠ¸ CSSê°€ CSPì— ì˜í•´ ì°¨ë‹¨ë¨.

**ìˆ˜ì •**: `next.config.js` CSP í—¤ë”ì— `https://cdn.jsdelivr.net` ì¶”ê°€.

```diff
- "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com"
+ "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net"

- "font-src 'self' https://fonts.gstatic.com"
+ "font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net"
```

### 2. ì£¼ë³´ ë¯¸ë¦¬ë³´ê¸° (Bulletin PDF Preview) ë³µêµ¬

**ë¬¸ì œ**: `/news/bulletin` í˜ì´ì§€ì˜ ìµœì‹  ì£¼ë³´ PDF ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ. CSP `frame-src`ì— Supabase Storage URLì´ ëˆ„ë½ë˜ì–´ iframeì´ ì°¨ë‹¨ë¨.

**ìˆ˜ì •**: `frame-src`ì— `https://*.supabase.co` ì¶”ê°€.

```diff
- "frame-src 'self' https://www.youtube.com https://youtube.com"
+ "frame-src 'self' https://www.youtube.com https://youtube.com https://*.supabase.co"
```

### 3. ìƒˆê°€ì¡± ë“±ë¡ ë§í¬ ë¦¬ë‹¤ì´ë ‰íŠ¸ ìˆ˜ì •

**ë¬¸ì œ**: í™ˆí˜ì´ì§€ ë¹ ë¥¸ ì ‘ê·¼ ë©”ë‰´ì˜ "ìƒˆê°€ì¡±" ì•„ì´ì½˜ì´ `/missions/new-family` (ìƒˆê°€ì¡±ì–‘ìœ¡ êµìœ¡ í˜ì´ì§€)ë¡œ ì—°ê²°ë¨. ì‚¬ìš©ìê°€ ê¸°ëŒ€í•˜ëŠ” ìƒˆê°€ì¡± ë“±ë¡ í¼(`/about/new-family-registration`)ì´ ì•„ë‹˜.

**ìˆ˜ì •**: `src/pages/index.tsx` quick access ë§í¬ ë³€ê²½.

```diff
- { icon: Users, titleKey: 'home:quick_access.new_family', href: '/missions/new-family' }
+ { icon: Users, titleKey: 'home:quick_access.new_family', href: '/about/new-family-registration' }
```

---

## ğŸ—„ï¸ Infrastructure

### 4. Supabase Storage `training` ë²„í‚· ìƒì„±

**ë¬¸ì œ**: í›ˆë ¨ ê´€ë¦¬ í˜ì´ì§€(`/admin/training/new`)ì—ì„œ íŒŒì¼ ì—…ë¡œë“œ ì‹œ `StorageApiError: Bucket not found` ì—ëŸ¬ ë°œìƒ.

**ìˆ˜ì •**: Supabase Storageì— `training` ë²„í‚· ìƒì„± + RLS ì •ì±… 4ê°œ ì ìš©.

| ì„¤ì • | ê°’ |
|------|-----|
| ë²„í‚· ì´ë¦„ | `training` |
| ê³µê°œ ì—¬ë¶€ | Public (ì½ê¸°) |
| ìš©ëŸ‰ ì œí•œ | 50MB |
| í—ˆìš© MIME | `application/pdf`, `video/mp4`, `video/webm`, `audio/mpeg`, `image/jpeg`, `image/png`, `image/webp` |

**RLS ì •ì±…**:

| ì •ì±… | ëŒ€ìƒ | ì„¤ëª… |
|------|------|------|
| SELECT | ì „ì²´ | ëˆ„êµ¬ë‚˜ íŒŒì¼ ì¡°íšŒ/ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ |
| INSERT | ì¸ì¦ ì‚¬ìš©ì | ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ì—…ë¡œë“œ ê°€ëŠ¥ |
| UPDATE | ì¸ì¦ ì‚¬ìš©ì | ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ìˆ˜ì • ê°€ëŠ¥ |
| DELETE | ì¸ì¦ ì‚¬ìš©ì | ë¡œê·¸ì¸ ì‚¬ìš©ìë§Œ ì‚­ì œ ê°€ëŠ¥ |

**ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼**: `supabase/migrations/20260209_create_training_storage_bucket.sql`

### 5. `site_settings` í…Œì´ë¸” ìƒì„±

**ëª©ì **: ì´ë©”ì¼ ë°œì‹  ì„¤ì •ì„ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ DB í…Œì´ë¸” ìƒì„±.

```sql
CREATE TABLE site_settings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  key VARCHAR(100) UNIQUE NOT NULL,
  value TEXT NOT NULL,
  description VARCHAR(500),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**ê¸°ë³¸ê°’**:

| key | value | ì„¤ëª… |
|-----|-------|------|
| `email_sender_name` | ìŠ¤í…Œì´íŠ¸ ì¹¼ë¦¬ì§€ í•œì¸êµíšŒ | ë°œì‹ ì ì´ë¦„ |
| `email_sender_address` | newsletter@sckc.org | ë°œì‹ ì ì´ë©”ì¼ |
| `email_reply_to` | (ë¹„ì–´ìˆìŒ) | ë‹µì¥ ë°›ì„ ì´ë©”ì¼ |

---

## âœ¨ New Features

### 6. ì´ë©”ì¼ ë°œì†¡ ì„¤ì • ê´€ë¦¬ UI

**íŒŒì¼**: `src/pages/admin/newsletter.tsx`

ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ë‰´ìŠ¤ë ˆí„° í˜ì´ì§€ì— ì´ë©”ì¼ ì„¤ì • ì„¹ì…˜ ì¶”ê°€:
- ë°œì‹ ì ì´ë¦„ ìˆ˜ì •
- ë°œì‹ ì ì´ë©”ì¼ ì£¼ì†Œ ìˆ˜ì •
- ë‹µì¥ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œ ì„¤ì •
- Resend API í‚¤ ìƒíƒœ í‘œì‹œ

### 7. `siteSettingsService.ts` ìƒì„±

**íŒŒì¼**: `src/utils/siteSettingsService.ts`

`site_settings` í…Œì´ë¸” CRUD ì„œë¹„ìŠ¤:
- `getSiteSetting(key)` - ë‹¨ì¼ ì„¤ì • ì¡°íšŒ
- `getEmailSettings()` - ì´ë©”ì¼ ì„¤ì • 3ê°œ ì¼ê´„ ì¡°íšŒ
- `updateSiteSetting(key, value)` - ë‹¨ì¼ ì„¤ì • ì—…ë°ì´íŠ¸
- `updateEmailSettings(settings)` - ì´ë©”ì¼ ì„¤ì • 3ê°œ ì¼ê´„ ì—…ë°ì´íŠ¸

### 8. Newsletter API - DB ì—°ë™

**íŒŒì¼**: `src/pages/api/email/newsletter.ts`

ë°œì‹ ì ì£¼ì†Œë¥¼ í•˜ë“œì½”ë”© ëŒ€ì‹  `site_settings` í…Œì´ë¸”ì—ì„œ ì½ë„ë¡ ìˆ˜ì •:

```diff
- from: 'noreply@statecollegekoreanchurch.org'
+ from: `${senderName} <${senderAddress}>`  // DBì—ì„œ ì¡°íšŒ
```

---

## ğŸ“ Documentation

### 9. Discussion í´ë” ìƒì„±

**íŒŒì¼**: `Discussion/2026-02-09_email-settings-infrastructure.md`

ì´ë²ˆ ì„¸ì…˜ì˜ ë…¼ì˜ ë‚´ìš©ì„ ë¬¸ì„œí™”:
- ë‰´ìŠ¤ë ˆí„° ì´ë©”ì¼ ì‹œìŠ¤í…œ í˜„í™© ë° ê³„íš
- Resend ì„œë¹„ìŠ¤ ë„ì… ê²°ì • ë°°ê²½
- ì¸í”„ë¼ êµ¬ì¡° (Vercel + Supabase + Resend)
- AWS êµ¬ë… ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€
- Gmail ë°œì†¡ ì œí•œ ì‚¬í•­ ë° ëŒ€ì•ˆ
- í–¥í›„ ì‘ì—… ìš°ì„ ìˆœìœ„ (P0/P1/P2)

---

## ğŸ”§ Technical Changes

### Files Modified (3)

| File | Changes |
|------|---------|
| `next.config.js` | CSP `style-src`, `font-src`ì— cdn.jsdelivr.net ì¶”ê°€, `frame-src`ì— *.supabase.co ì¶”ê°€ |
| `src/pages/index.tsx` | ìƒˆê°€ì¡± quick access ë§í¬ `/missions/new-family` â†’ `/about/new-family-registration` |
| `src/pages/api/email/newsletter.ts` | í•˜ë“œì½”ë”© ë°œì‹ ì â†’ site_settings DB ì¡°íšŒ |

### Files Added (3)

| File | Description |
|------|-------------|
| `src/utils/siteSettingsService.ts` | site_settings í…Œì´ë¸” CRUD ì„œë¹„ìŠ¤ |
| `supabase/migrations/20260209_create_training_storage_bucket.sql` | training ë²„í‚· ìƒì„± ë§ˆì´ê·¸ë ˆì´ì…˜ |
| `Discussion/2026-02-09_email-settings-infrastructure.md` | ì¸í”„ë¼ ë…¼ì˜ ë¬¸ì„œ |

### Files Updated (1)

| File | Changes |
|------|---------|
| `src/pages/admin/newsletter.tsx` | ì´ë©”ì¼ ì„¤ì • ê´€ë¦¬ UI ì¶”ê°€ |

---

## ğŸ“Š Build Statistics

| Metric | Value |
|--------|-------|
| Files Modified | 4 |
| Files Added | 3 |
| Lines Added | ~465 |
| Lines Removed | ~12 |
| Build Errors | 0 |
| TypeScript Errors | 0 |

---

## ğŸŒ Deployment

- **Platform:** Vercel (ìë™ ë°°í¬)
- **Production URL:** https://www.sckc.org
- **Status:** Deployed
- **Database Changes:** `site_settings` í…Œì´ë¸” ìƒì„±, `training` Storage ë²„í‚· ìƒì„±
- **Migration Required:** ì•„ë‹ˆì˜¤ (APIë¡œ ì§ì ‘ ìƒì„± ì™„ë£Œ)

---

## ğŸ”„ Migration Notes

### ì™„ë£Œëœ ì‘ì—…
- `training` Storage ë²„í‚·: APIë¡œ ì§ì ‘ ìƒì„± ì™„ë£Œ (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì€ ê¸°ë¡ìš©)
- `site_settings` í…Œì´ë¸”: APIë¡œ ì§ì ‘ ìƒì„± ì™„ë£Œ
- RLS ì •ì±…: APIë¡œ ì§ì ‘ ì ìš© ì™„ë£Œ

### í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í™ˆí˜ì´ì§€ "ìƒˆê°€ì¡±" ì•„ì´ì½˜ â†’ `/about/new-family-registration` ì´ë™ í™•ì¸
- [ ] `/news/bulletin` ì£¼ë³´ PDF ë¯¸ë¦¬ë³´ê¸° ì •ìƒ í‘œì‹œ í™•ì¸
- [ ] Pretendard í°íŠ¸ ì •ìƒ ë¡œë”© í™•ì¸ (ì½˜ì†” CSP ì—ëŸ¬ ì—†ìŒ)
- [ ] `/admin/training/new` íŒŒì¼ ì—…ë¡œë“œ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] `/admin/newsletter` ì´ë©”ì¼ ì„¤ì • UI í‘œì‹œ í™•ì¸

### Breaking Changes

**ì—†ìŒ** - ê¸°ì¡´ URL ë° ê¸°ëŠ¥ ìœ ì§€.

---

## âš ï¸ Known Issues / ë‹¤ìŒ ë‹¨ê³„

### ì´ë©”ì¼ ë°œì†¡ ë¯¸ì™„ì„± (Resend ì„¤ì • í•„ìš”)

ì´ë©”ì¼ ì„¤ì • UIì™€ API ì½”ë“œëŠ” ì¤€ë¹„ë˜ì—ˆìœ¼ë‚˜, ì‹¤ì œ ë°œì†¡ì„ ìœ„í•´ ë‹¤ìŒ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤:

| ìš°ì„ ìˆœìœ„ | ì‘ì—… | ì„¤ëª… |
|----------|------|------|
| **P0** | Resend ê³„ì • ìƒì„± | https://resend.com ë¬´ë£Œ ê°€ì… |
| **P0** | API í‚¤ ë°œê¸‰ | Resend ëŒ€ì‹œë³´ë“œ â†’ API Keys |
| **P0** | Vercel í™˜ê²½ë³€ìˆ˜ | `RESEND_API_KEY=re_xxxxxxxxxx` ì„¤ì • |
| **P0** | DNS ë ˆì½”ë“œ ì¶”ê°€ | Network Solutions â†’ sckc.orgì— SPF/DKIM/DMARC ì¶”ê°€ |
| P1 | ë°œì†¡ ê¸°ë¡ í…Œì´ë¸” | `newsletter_logs` í…Œì´ë¸” ìƒì„± |
| P1 | ë°œì†¡ ë‚´ì—­ UI | ë°œì†¡ ê¸°ë¡ ì¡°íšŒ ê¸°ëŠ¥ |
| P2 | ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° | ë°œì†¡ ì „ HTML ë¯¸ë¦¬ë³´ê¸° |

### AWS êµ¬ë… ì •ë¦¬

Vercel + Supabase + Resendë¡œ ì™„ì „ ì´ì „ í›„ AWS ì„œë¹„ìŠ¤ ì·¨ì†Œ ê°€ëŠ¥. ì·¨ì†Œ ì „ AWS ì½˜ì†”ì—ì„œ í™œì„± ì„œë¹„ìŠ¤ í™•ì¸ ê¶Œì¥.

---

## ğŸ“ Commits

| Hash | Message |
|------|---------|
| `1704f1e` | Fix CSP for Pretendard font and create training storage bucket |
| `be7799e` | Fix new family link, CSP frame-src for bulletin preview, add email settings UI |

---

**Release Date:** 2026-02-09
**Document Version:** 1.0
